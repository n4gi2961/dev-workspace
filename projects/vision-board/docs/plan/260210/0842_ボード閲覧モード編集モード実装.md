# ボード閲覧モード / 編集モード 実装計画

## Context

現在のボード画面は常に「編集状態」（ノードタップで選択・リサイズ・ツールバー表示、右下FABで画像/テキスト追加）。
ユーザーの要望: 「閲覧モード」をデフォルトにし、右下ボタンで「編集モード」に切り替える構造にする。
閲覧モードでの画像タップは将来の機能用に空けておく。

## 変更概要

| # | ファイル | 変更内容 |
|---|---------|---------|
| 1 | `app/(main)/(tabs)/index.tsx` | `canvasMode` state追加、EditButton/FABMenu条件分岐、ボード切替時リセット |
| 2 | `components/canvas/BoardCanvas.tsx` | `mode` prop追加、NodeToolbar/ドラッグヒント/TextEditorをedit時のみ表示 |
| 3 | `components/canvas/CanvasNode.tsx` | `mode` prop追加、viewモードでタップ/ドラッグ/ダブルタップ無効化 |
| 4 | `components/canvas/FABMenu.tsx` | `onDone` prop追加、完了ボタン（checkアイコン）をFABの左に配置 |

※新規ファイルなし。EditButtonはindex.tsx内にインラインで記述（FABコンポーネント1つ使うだけなので）。

## 詳細設計

### 1. index.tsx — モード状態管理

```typescript
type CanvasMode = 'view' | 'edit';
const [canvasMode, setCanvasMode] = useState<CanvasMode>('view');
```

- ボード切替時（`selectedBoardId`変更）に`'view'`にリセット
- `handleDoneEditing`: `selectNode(null)` + `setCanvasMode('view')`

JSX条件分岐:
```tsx
{selectedBoardId && canvasMode === 'view' && (
  <View style={{ position:'absolute', right:24, bottom: tabBarHeight+16, zIndex:100 }}>
    <FAB icon="pen-line" onPress={() => setCanvasMode('edit')} />
  </View>
)}
{selectedBoardId && canvasMode === 'edit' && (
  <FABMenu onAddImage={handleAddImage} onAddText={handleAddText} onDone={handleDoneEditing} />
)}
```

### 2. BoardCanvas.tsx — mode prop

Props に `mode: 'view' | 'edit'` を追加。

条件分岐（editモード時のみ表示）:
- NodeToolbar → `mode === 'edit' && selectedNode && ...`
- ドラッグヒント → `mode === 'edit' && !selectedNodeId && ...`
- TextEditor → `mode === 'edit' && selectedNode && ...`
- `handleDoubleTap`: `mode !== 'edit'` なら early return

### 3. CanvasNode.tsx — mode prop

Props に `mode: 'view' | 'edit'` を追加。

- `handleSelectJS`: modeが`'edit'`の時のみ`onSelect`を呼ぶ
- `handleDoubleTapJS`: modeが`'edit'`の時のみ`onDoubleTap`を呼ぶ
- `panGesture.enabled()`: `isSelected && mode === 'edit'`

### 4. FABMenu.tsx — 完了ボタン追加

`onDone?: () => void` propを追加。

FABボタンの左に完了ボタン（checkアイコン、40x40、borderRadius:20、bg:#2C2C2E）を配置。

## 検証方法

1. TypeScriptビルドチェック: `npx tsc --noEmit` (新規エラーなし確認) → **完了**
2. 動作確認項目:
   - アプリ起動 → ボード選択 → 右下に pen-line アイコンのFABが表示される（閲覧モード）
   - 画像タップ → 何も起きない
   - pen-line FABタップ → FABMenuに切り替わる（編集モード）
   - ノードタップ → 選択枠・ツールバー表示
   - FABの左のcheckボタンタップ → 閲覧モードに戻る（選択解除）
   - ボード切替 → 閲覧モードにリセット
