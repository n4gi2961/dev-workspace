# Phase 0.5: UIコンポーネントライブラリ構築

## Context

Phase 0（基盤整備 + R2 Worker）完了済み。4pxグリッド正規化も完了済み。
次のステップとして、`.pen`ファイルの24個の再利用可能コンポーネントをRN/NativeWindコンポーネントに変換し、後続Phase（画面実装）で使えるUIライブラリを構築する。

**既存コードは無視して.penから完全新規作成する。** 既存の`components/navigation/TopBar.tsx`、`Sidebar.tsx`等は.penの設計と乖離しているため置き換える。

---

## 1. 前提作業（完了済み）

- [x] 4pxグリッド正規化（padding, cornerRadius, fontSize）
- [x] .penテーマ変数の確認

---

## 2. tailwind.config.js テーマ拡張

**ファイル:** `apps/mobile/tailwind.config.js`

.penの変数定義をTailwind extend に反映する:

```js
theme: {
  extend: {
    colors: {
      accent: { primary: '#3B82F6', light: '#EFF6FF' },
      destructive: '#EF4444',
      surface: { DEFAULT: '#1F2937', dark: '#1F2937', light: '#FFFFFF' },
      canvas: '#111827',
      border: { DEFAULT: '#374151', light: '#E4E4E7' },
      txt: {
        primary: '#FFFFFF',    // dark mode default
        secondary: '#D1D5DB',
        tertiary: '#A1A1AA',
        muted: '#D4D4D8',
      },
    },
    spacing: {
      // .pen変数: xs=2, sm=4, md=8, base=12, lg=16, xl=24, section=32
      // Tailwind標準: 0.5=2, 1=4, 2=8, 3=12, 4=16, 6=24, 8=32
      // → 標準で十分カバー。追加不要。
    },
    borderRadius: {
      // .pen変数: sm=8, md=12, lg=16, full=100
      // Tailwind標準: DEFAULT=4, md=6, lg=8, xl=12, 2xl=16, full=9999
      // → sm(8)はTW "lg"、md(12)はTW "xl"、lg(16)はTW "2xl"で対応
      // 追加不要だがセマンティック名を使いたい場合:
    },
  },
}
```

**判断:** spacingとborderRadiusはTailwind標準クラスで十分マッピングできるため、colorsのみ追加。

---

## 3. コンポーネント一覧と実装順序

### 配置: `apps/mobile/components/ui/`

既存の`components/`は残すが、新UIは全て`ui/`サブディレクトリに集約。

### バッチ1: ボタン系（1ファイル）

**ファイル:** `components/ui/Button.tsx`

| variant | .pen ID | 構造 |
|---------|---------|------|
| primary | qGJOW | icon? + label, fill blue, rounded-lg, p-4, gap-1.5 |
| outline | bGVBO | icon? + label, border, rounded-lg, p-4, gap-1.5 |
| destructive | A0haQ | label only, fill red, rounded-lg, p-4 |
| icon | F08vc | 48x48 circle, icon only, border |
| fullscreen | DyIbZ | 44x44 circle, blur bg, translucent |

```typescript
interface ButtonProps {
  variant: 'primary' | 'outline' | 'destructive' | 'icon' | 'fullscreen';
  label?: string;
  icon?: string;        // lucide icon name
  onPress?: () => void;
  disabled?: boolean;
  className?: string;   // 追加のNativeWindクラス
}
```

**可変性分析（.penオーバーライドから）:**
- label: 画面ごとに変わる（"Button" / "Logout" / "Get Started" 等）
- icon: 変わる or 非表示（"plus" / "bell" / "maximize-2"等）
- variant自体の切り替えで見た目が変わる

### バッチ2: TopBar（1ファイル）

**ファイル:** `components/ui/TopBar.tsx`

.pen ID: `wMbzi` — 横並び、高さ64、3セクション

```typescript
interface TopBarProps {
  title?: string;
  leftIcon?: string;         // default: "menu"
  onLeftPress?: () => void;
  rightIcon?: string;        // default: "sparkles"
  onRightPress?: () => void;
  showRight?: boolean;       // default: true
  titleAlign?: 'center' | 'start';  // default: 'center'
}
```

**可変性分析（.penオーバーライドから）:**
- `6RqVu` (title): "Main Board", "My first board", "プランの解約" 等
- `L7HTC` (leftIcon): "menu"(default) → "chevron-left"(サブページ)
- `lCZoq` (rightIcon): "sparkles"(default) → 色変更(#ffd700) or 非表示
- `lIbcx` (titleAlign): center(default) → start(サブページ)
- `rxsej` (showRight): true → false(サブページ)

### バッチ3: TabBar（1ファイル）

**ファイル:** `components/ui/TabBar.tsx`

.pen ID: `bwPb3` + `LttJA` — expo-routerの`tabBar`カスタムコンポーネントとして実装

```typescript
// expo-router の BottomTabBarProps を受け取る
interface CustomTabBarProps {
  state: TabNavigationState;
  descriptors: Record<string, BottomTabDescriptor>;
  navigation: NavigationHelpers;
}
```

**構造:**
- 上部: グラデーションフェード（16px）
- 下部: ブラー背景 + 3つのTab/Item
- Tab/Item: icon(22x22) + label(12px), gap 4, active=accent-primary/inactive=text-tertiary

**可変性:** activeTabのみ。icon/labelは`_layout.tsx`のtabBarLabel/tabBarIconで定義。

### バッチ4: Input系（1ファイル）

**ファイル:** `components/ui/Input.tsx`

| variant | .pen ID | 構造 |
|---------|---------|------|
| text | kPihi | height 48, border, rounded-lg, px-4, placeholder |
| search | en9Si | height 48, border, rounded-xl, px-4, gap-3, search icon + text |

```typescript
interface InputProps {
  variant?: 'text' | 'search';
  placeholder?: string;
  value?: string;
  onChangeText?: (text: string) => void;
  className?: string;
}
```

### バッチ5: FAB系（1ファイル）

**ファイル:** `components/ui/FAB.tsx`

| component | .pen ID | 構造 |
|-----------|---------|------|
| FAB | nI3ee | 56x56 blue circle, icon |
| FAB.MenuItem | mu0ET | icon + label, dark translucent, rounded-xl |

```typescript
interface FABProps {
  icon?: string;       // default: "plus"
  onPress?: () => void;
}

interface FABMenuItemProps {
  icon: string;
  label: string;
  onPress?: () => void;
}
```

**可変性:** iconが "plus" ↔ "x"（展開時切替）

### バッチ6: Card / ListItem（1ファイル）

**ファイル:** `components/ui/Card.tsx`

```typescript
interface CardProps {
  title?: string;
  description?: string;
  children?: React.ReactNode;  // カスタムコンテンツ
  className?: string;
}
```

**ファイル:** `components/ui/ListItem.tsx`

```typescript
interface ListItemProps {
  title: string;
  meta?: string;
  status?: 'none' | 'active' | 'complete';
  onPress?: () => void;
  onStatusPress?: () => void;
}
```

### バッチ7: ステータス / トースト / その他（1ファイル）

**ファイル:** `components/ui/StatusBadge.tsx`

```typescript
interface StatusBadgeProps {
  variant: 'complete' | 'active' | 'empty';
  onPress?: () => void;
}
```

**ファイル:** `components/ui/Toast.tsx`

```typescript
interface ToastProps {
  message: string;
  visible: boolean;
}
```

**ファイル:** `components/ui/BoardAvatar.tsx`

```typescript
interface BoardAvatarProps {
  color?: string;
  thumbnails?: string[];  // 画像URL配列
  size?: number;          // default: 108
}
```

**ファイル:** `components/ui/ImageLoader.tsx`

```typescript
// シマー付きプレースホルダー
interface ImageLoaderProps {
  width?: number;
  height?: number;
}
```

### 実装しないもの

| コンポーネント | 理由 |
|----------------|------|
| StatusBar (IOzI6) | RNの`<StatusBar>`とSafeAreaViewで代替 |
| Sound/Card, Slider, WaveformBtn, Badge | product-concept.mdに未記載、将来機能 |

---

## 4. 実装順序（依存関係順）

```
Step 1: tailwind.config.js テーマ拡張 + constants/colors.ts 更新
Step 2: Button.tsx（他に依存なし、最も基本的）
Step 3: TopBar.tsx（画面で最多使用）
Step 4: Input.tsx（認証画面で必要）
Step 5: FAB.tsx（キャンバス画面で必要）
Step 6: TabBar.tsx（全タブ画面の共通ナビゲーション）
Step 7: Card.tsx + ListItem.tsx + StatusBadge.tsx
Step 8: Toast.tsx + BoardAvatar.tsx + ImageLoader.tsx
Step 9: index.ts バレルエクスポート
```

---

## 5. 共通パターン

### NativeWindクラスマッピング規則

| .pen property | NativeWind class |
|---------------|------------------|
| `padding: 16` | `p-4` |
| `padding: [0, 16]` | `px-4` |
| `gap: 12` | `gap-3` |
| `cornerRadius: 8` | `rounded-lg` |
| `cornerRadius: 12` | `rounded-xl` |
| `cornerRadius: 16` | `rounded-2xl` |
| `cornerRadius: 24` | `rounded-3xl` |
| `cornerRadius: 100` | `rounded-full` |
| `fontSize: 12` | `text-xs` |
| `fontSize: 14` | `text-sm` |
| `fontSize: 16` | `text-base` |
| `fontSize: 20` | `text-xl` |
| `fontSize: 24` | `text-2xl` |
| `fontWeight: "500"` | `font-medium` |
| `fontWeight: "600"` | `font-semibold` |
| `fontWeight: "700"` | `font-bold` |
| `alignItems: "center"` | `items-center` |
| `justifyContent: "center"` | `justify-center` |
| `justifyContent: "space_between"` | `justify-between` |
| `width: "fill_container"` | `flex-1` or `w-full` |
| `layout: "vertical"` | `flex-col` |
| `layout: "horizontal"` (default) | `flex-row` |
| `stroke: { fill, thickness }` | `border border-[color]` |

### アイコンの扱い

```typescript
import { icons } from 'lucide-react-native';

// アイコン名を文字列で受け取り動的にレンダリング
function LucideIcon({ name, size, color }: { name: string; size: number; color: string }) {
  const Icon = icons[name as keyof typeof icons];
  if (!Icon) return null;
  return <Icon size={size} color={color} />;
}
```

全コンポーネントでこのヘルパーを共有。`components/ui/LucideIcon.tsx` として切り出す。

### Animated.View と NativeWind

`Animated.View` には `className` が効かない場合がある。アニメーション対象のコンポーネント（TabBar、FAB展開等）は `style` prop を使用し、静的部分のみ `className` を使う。

---

## 6. 対象ファイル一覧

### 変更
- `apps/mobile/tailwind.config.js` — テーマ拡張（colors追加）
- `apps/mobile/constants/Colors.ts` — .pen変数に合わせて書き換え

### 新規作成
- `apps/mobile/components/ui/LucideIcon.tsx` — 動的アイコンヘルパー
- `apps/mobile/components/ui/Button.tsx` — 5 variant
- `apps/mobile/components/ui/TopBar.tsx` — title + left/right actions
- `apps/mobile/components/ui/TabBar.tsx` — expo-router custom tabBar
- `apps/mobile/components/ui/Input.tsx` — text + search variant
- `apps/mobile/components/ui/FAB.tsx` — FAB + MenuItem
- `apps/mobile/components/ui/Card.tsx` — Base card
- `apps/mobile/components/ui/ListItem.tsx` — With status badge
- `apps/mobile/components/ui/StatusBadge.tsx` — complete/active/empty
- `apps/mobile/components/ui/Toast.tsx` — メッセージ表示
- `apps/mobile/components/ui/BoardAvatar.tsx` — ボードサムネイル
- `apps/mobile/components/ui/ImageLoader.tsx` — シマープレースホルダー
- `apps/mobile/components/ui/index.ts` — バレルエクスポート

計: 変更2ファイル + 新規13ファイル

### 削除候補（.penベースに置き換え後）
- `apps/mobile/components/navigation/TopBar.tsx` → `ui/TopBar.tsx` で置き換え
- `apps/mobile/components/Themed.tsx` → NativeWindテーマで不要に
- `apps/mobile/constants/Colors.ts` → 書き換え

---

## 7. 検証方法

各コンポーネント作成後:
1. `components/ui/__tests__/` でスナップショットテスト（任意）
2. 既存画面の一部で新コンポーネントに差し替えて動作確認
3. .penスクリーンショットとRNレンダリング結果の目視比較
