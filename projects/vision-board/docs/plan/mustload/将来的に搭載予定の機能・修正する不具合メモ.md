# このページの記載ルール
[]内に含まれる数字は優先度・重要度を表し5が最も大きく1が最も小さい。

# 将来的に搭載する機能
## [5]ウィジェット機能
選んだ画像＋オーバーレイを表示。タップしか使えないからこれだけだが価値はある　自分のホーム画面に画像と目標が常に表示される

## [5]starstack :white_check_mark: 完了 (260213)
web版にあるように、ルーティンにチェックを入れると星が瓶にたまっていく　3Dでの実装は難しい？できれば3Dで行いたい
→ R3F v9 + JS物理エンジンで3D実装完了。物理微調整（床位置・衝突判定・復元アニメ・強制静止・カメラ慣性）も260213で完了

## [4]Star Stackの「瓶がいっぱいになったら」の設計
現状、瓶が満杯になった後の体験が未定義に見える。満杯になった瞬間はこのアプリ最大の感情的ピークになりえる。ここに何もないと拍子抜けになる。「新しい瓶が始まる演出」「満杯の瓶がコレクションされていく画面」などを早めに設計しておく価値がある。

## [5]「振り返り」のトリガー機能
現状、彩度変化とStar Stackで「今日やったこと」のフィードバックはあるけど、「この1ヶ月で自分がどれだけ進んだか」を俯瞰する仕組みがない。週次・月次で自動的に「あなたの1週間」のようなダイジェストを生成して、Star Stackの増加量、最もチェックしたルーティン、彩度が最も上がったボードなどを見せる。これは長期報酬層をさらに強化する。Star Stackが「量」の可視化なら、これは「変化の軌跡」の可視化。続ける理由が「溜まってるから」だけでなく「こんなに変わったから」になる。　ボードごとに作成し、なおかつ1つだけ「次の週(月)で注力すること」という質問を投げかけ、それを次のレポートの時に表示することで目標に注意を向けさせ続けられる

## ~~[4] ルーティンの「連鎖」設計 -habit stacking~~ :white_check_mark: 完了 (260218)
~~今のルーティンは個別チェックだけど、「朝の儀式」として複数ルーティンをグループ化して順番に表示する機能。例えば「瞑想5分→ジャーナリング→ストレッチ10分」を一連の流れとして提示する。これは企画書にある「儀式化」のアイディアと直結する。音楽連携よりも先に、行動の順序自体を儀式にする方がコアに近い。これは見た目を工夫して、上から順番に並べつつ「一括チェック」と「個別チェック」の両方をできるようにした方がいい~~
→ routine_stacksテーブル追加、スタックCRUD・一括チェック・縦線UI実装済み（260218 10:13）。統一順序モデル（スタックと未所属の混合ソート）・ドラッグ並び替え全面改修・左カラムリサイズも実装完了（260218 13:30）。実機動作確認が次の課題。

## [4]概要の簡易追加
ページの「カテゴリー設定・年代設定」の左に「概要」を作成。ほか二つと同様タップで下に展開する。内容は自由記述形式だが、プレースホルダーとして「なぜそれをやるのか？その結果何を得られるのか？」というようなことを書いておくことで、「自分はなぜこの目標を目指すのか、達成出来たらどんな気分を味わえるのか」をユーザーに意識させ、より自分事として意識できるようにする。このアプリはすべて「自分にとって重要なこととは何か、それを達成するためには何をしなければならないか？」ということに集中し、それを楽しみながら実行するために設計されている。
初回にボードを作った時に「この目標を達成したら、あなたの生活はどう変わる？」という1問だけの質問を出して、回答をボードのどこかに常に薄く表示する。自由記述フィールドを用意して待つより、1回だけ問いかけて可視化する方がユーザーの行動を引き出せる。

## [5]~~閲覧モードでのダブルタップで一斉オーバーレイ操作~~ :white_check_mark: 完了 (260210)
閲覧モード中、画像以外の場所をダブルタップすることで、ボードのすべての画像のオーバーレイを一括で操作できる。1つもオンでないなら全てにオーバーレイが表示され、1つでもオンならオーバーレイが全て非表示になる。
## [5]ページを下スワイプで閉じる
260210のページ横スワイプ移動を追加してから出来なくなった。要修正→度重なるエラーで実装断念。閉じるボタンの視認性と大きさを向上させて一時的対処
## [5]課金画面と機能
mobile_UI.penのものを流用。サブスク購入が必要な場面で表示される。

# 搭載可能性のある機能のアイディア
## [4]Focus Timer機能(Bottom Nav:2) — メイン機能 :white_check_mark: 完了 (260211)
### メイン機能 :white_check_mark:
ルーティンの文字列に含まれる180以下の数字を時間として認識し、ボード・focusのオーバーレイからタップするとボトムタブ2番目のタイマーにジャンプ。その時間にセットされた大きなタイマー、[30分○○する]という大きなタイトルと時間変更パネル、其れから開始ボタン。開始ボタンを押すと時間パネルとボトムバーが画面外に移動し残るのはタイトル、タイマー、一時停止・停止ボタンだけ。一時停止または停止でボトムバーが復帰。　時間が終わったら終了画面と大きなチェックボタン。押したら確定で流星のエフェクト。そして通常のタイマー画面に戻る。
### サブ機能（未実装）
画面をオフにしてもホーム画面にタイマーとタイトルだけのシンプルなウィジェットが表示されるようにしたい。iphoneのワークアウト中のような

## [3]ボード・画像ノードの共有や投稿・自分のボードに追加する機能(BottomNav:4)
### メイン機能
Focusの縦スワイプをそのまま応用し、他人が投稿したボードの画像を参考に見たり自分のボードに追加できる。focusの画面に、「下スワイプで別の人のボードに移動」「右上に:white_check_mark:できる追加ボタン」「このボードを見るボタン」があればフロントは実装できる。ユーザーは縦スワイプで人の画像を見て、いいなと思った画像にチェックを入れて最後にまとめて追加できる。さらにボードを眺めるボタンを押したら人が丁寧に作ったきれいなボードと目標を見て、それをそのまま自分のボードリストにも追加できる。　問題はどうやってストレージ管理するか、レコメンドのアルゴリズムをどう取り入れるのか、いいねをつけるのか(つけない。そんなものはインスタでやってもろて、自分に必要だと思ったものを追加して編集する)

## [3]ボードの変更機能 :white_check_mark: 完了 (260211)
### メイン機能 :white_check_mark:
シンプルな単色ボードはデフォルトで使えるようにして、プレミアムなもの(格子状に星のドットを配置したもの:ウェブ版を参照/木目調/かわいらしい質感のボード/上質な紙に罫線/コルクボードと端をピンでとめる)は購入してから使えるようにする。ボード一覧から長押し→編集・削除の中に「ボード背景を変更」を追加。選択で2×Nのボード選択画面を新たに作成
→ 12種類のパターン（default + 11パターン）で実装済み。課金連携は未実装。
# 修正する不具合・軽微な調整
## ~~[5]閲覧モードが編集モードよりも動作がもっさりしていることの改善・最適化~~ :white_check_mark: 完了 (260211)
260210_1123 閲覧モード機能拡張_全画面_オーバーレイ実装で行った、閲覧モードの最適化操作がむしろ画像が多いときの動作の重さにつながっている。具体的に行った操作を下記に記載する
### ~~パフォーマンス最適化（viewモード~~
- **GPU rasterization**: `shouldRasterizeIOS`/`renderToHardwareTextureAndroid`でノードを単一テクスチャ化
- **GestureDetector → Pressable**: viewモードでは軽量なPressableのみ使用（ジェスチャーシステム負荷1/3以下）
- **静的positioning**: Reanimated shared valuesの代わりに`left: node.x, top: node.y`直接指定
- **React.memo**: CanvasNodeをmemoでラップ


~~ボードの移動をスムーズに(スワイプして指を離したら飛んでいくような感じ)~~ :white_check_mark: 完了 (260210)
ボード上の文字を編集しようとしたとき、ボトムメニューが表示される形式を、近くにポップアップするメニューに変更。
~~ボタンや画像をタップして表示されるediter barを、対象物の真下ではなく、バーが全て画面上に映るように調節する~~ :white_check_mark: 完了 (260210)
~~編集モードで画像をタップして出てくるサイズ変更用の〇は、image editer同様ボードのズーム倍率に関わらず一定の大きさを保つ。~~ :white_check_mark: 完了 (260210)
~~画像サイズ変更中の途中経過が見えないため最適な場所に置けているかわからない。動かすときのようにサイズ調整中も常に変更後の状態を見ることはできない？~~ :white_check_mark: 完了 (260210)
## ~~[3]image editer barの機能の調整~~ :white_check_mark: 完了 (260212)
~~ページ編集ボタン(一番左)を削除。~~ :white_check_mark:
~~AAが縦に並んでいる~~ :white_check_mark: → alignItems: 'baseline'で修正
~~AAの機能は画像サイズの変更ではなく、画像上に表示するオーバーレイの文字のサイズ調整~~ :white_check_mark: → hoverFontSize (L/M/S) で実装・永続化
~~アスペクト比のボタンは「押すとアスペクト比が固定され、その比率を保ったままサイズが変わる」仕様~~ :white_check_mark: → FREE/ORIG/3:4/1:1/4:3で実装・永続化
※ ORIGINALアスペクト比が元画像の比率で正しく動作するか実機検証が必要
~~ページ右上のボタンのアイコンをもう一回り大きく、上部のインジケーターも16pxほど上に移動。またボタンとインジケーターのバックに不透明で薄いグレーの丸を追加(背景が白の時ボタンが見えない)~~ :white_check_mark: 完了 (260210)


## ~~アイコンと文字が縦積みになっている個所の修正~~ :white_check_mark: 完了 (260210)
~~ページ→カテゴリー(場所など)~~
~~　profile->settingsのサブスクリプション管理・ログアウト~~


# アプリのアイディア、コンセプトについての深堀り
## 儀式化
このアプリをただの習慣トラッカーではなく、重要な儀式の一つとして扱うようにしたい。
### そのためのアイディア
音楽を再生する機能(音楽アプリと連携して好きな曲を流せるように)
表示順の固定化:見る順番を大事にする人なら


 
# 教訓
ここに開発中に気づいた教訓を書き留めておく。今後同じようなミスをしないように

260210「夜のClaudeに大規模修正をさせない-なぜなら彼はポンコツになるから」
260211「ログなしクラッシュは最小構成から段階的に確認する-なぜなら原因特定が困難だから」
260213 「どんな複雑な操作でも1回の返信までに使用するのは100k tokensまで -なぜなら調査だけでトークンを使い果たしたら何も進まないから」