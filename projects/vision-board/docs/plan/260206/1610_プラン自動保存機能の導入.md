# プランモード承認時のプラン自動保存機能

## Context
プランモードで作成した計画は `/root/.claude/plans/` に一時保存されるが、承認後に消えてしまい、後から参照できない。開発の意思決定履歴として `projects/vision-board/docs/plan/` にmdファイルとして残したい。既存のログ保存の仕組み（log-config.json + CLAUDE.md指示）のパターンに合わせて実装する。

## アプローチ: CLAUDE.md指示ルール

Claude Codeのフックイベントには「プラン承認」に対応するものがないため、**CLAUDE.mdにルールを追加**してClaudeの動作として組み込む。既存の「pencil MCPは必ず保存すること」と同じパターン。

## 変更内容

### 1. CLAUDE.mdにプラン保存ルールを追加

```
### プランモードの計画保存
プランモードで承認されたプランは、実行開始時に以下の手順で保存すること：
1. プランファイル（`/root/.claude/plans/` 内）の内容を読み取る
2. 日付フォルダ（YYMMDD）を作成（既存なら省略）
3. ファイル名を `HHmm_タイトル.md` 形式で生成
4. `outputFolder/YYMMDD/HHmm_タイトル.md` に保存
```

### 2. プラン保存設定ファイル
**ファイル**: `/home/claude-code/.claude/plan-config.json`

```json
{
  "outputFolder": "/home/claude-code/projects/vision-board/docs/plan",
  "filenameFormat": "YYMMDD_HHmm"
}
```

### 保存構造
```
docs/plan/
  260206/
    1610_プラン自動保存機能の導入.md
    1730_次のプラン.md
  260207/
    0900_別の日のプラン.md
```
